var player,balls=[],playerElement,ballElements=[],animationID,ticks=0,seconds=0,playerMoves=[],trials=1,log;function ballsCollide(a,b,c,d){var e=Math.abs(b.xPos+d/2-(a.xPos+c/2));a=Math.abs(b.yPos+d/2-(a.yPos+c/2));return Math.sqrt(e*e+a*a)<c/2+d/2}function moveEverything(){player.move(600,500);for(var a=0;a<balls.length;a++){var b=balls[a],c=ballElements[a];b.move(600,500);c.css("left",b.xPos);c.css("top",b.yPos)}playerElement.css("left",player.xPos);playerElement.css("top",player.yPos)}
function collision(){for(var a=!1,b=0;b<balls.length;b++)if(ballsCollide(balls[b],player,50,30)){a=!0;break}return a}function deathAnimation(){setInterval(function(){var a="#FF00"+(0).toString();$(".ball").css("background-color",a)},17)}
function calculateScore(){for(var a=0,b=seconds+ticks/60,c=0;c<balls.length;c++)var d=balls[c],a=a+(Math.abs(d.xVel)+Math.abs(d.yVel));c=b*balls.length*a;c-=15*(Math.pow(balls.length,2)-balls.length)/2;log.append("<tr><td>"+trials.toString()+"</td><td>"+balls.length.toString()+"</td><td>"+a+"</td><td>"+a/balls.length+"</td><td>"+b+"</td><td>"+c.toString()+"</td></tr>");trials++;return c}
function startGame(){console.log("Starting a game.");animationID=setInterval(function(){0<playerMoves.length&&player.changeDirection(playerMoves.shift());moveEverything();if(collision()){clearInterval(animationID);deathAnimation();var a=calculateScore();$("#timePlayed").append("<strong>Time:</strong> "+seconds+"."+1E3*ticks+" s");$("#totalScore").append("<strong>Score:</strong> "+a.toString());$("body").append('<div id="startGame">Restart</div>');$("#startGame").unbind().click(function(){for(var a=
0;a<ballElements.length;a++)ballElements[a].remove();playerMoves=[];player.xPos=0;player.yPos=0;seconds=ticks=player.vel=0;balls=[];ballElements=[];$("#timePlayed").text("");$("#totalScore").text("");startGame();$("#startGame").remove()})}60===++ticks&&(ticks=0,0===++seconds%10?addBall():7<seconds%10?$("#originBox").css("background-color","red"):$("#originBox").css("background-color","white"))},17);addBall()}
function addBall(){var a=new Ball(300,250),b=$('<div class="ball"></div>');balls.push(a);ballElements.push(b);$("#space").append(b)}$(document).ready(function(){player=new Player(0,0);playerElement=$("#player");$("#startGame").unbind().click(function(){startGame();$("#startGame").remove()});log=$("#log")});$(document).on("keydown",function(a){playerMoves.push(a.keyCode)});
